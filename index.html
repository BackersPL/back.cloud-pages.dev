<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Licenses — podgląd</title>
  <style>
    body{font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;margin:0;background:#0f172a;color:#e6eef8;display:flex;flex-direction:column;min-height:100vh}
    header{padding:1rem 1.25rem;background:linear-gradient(90deg,#0b1220,#172133);box-shadow:0 2px 6px rgba(0,0,0,.4)}
    h1{margin:0;font-size:1rem}
    main{flex:1;display:flex;gap:1rem;padding:1rem}
    .card{background:linear-gradient(180deg,#071025,#0b1320);border-radius:12px;padding:1rem;flex:1;box-shadow:0 6px 20px rgba(2,6,23,.6)}
    pre{white-space:pre-wrap;word-break:break-word;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,monospace;font-size:0.95rem;margin:0}
    .toolbar{display:flex;gap:.5rem;align-items:center;margin-bottom:.75rem}
    button{background:#1f2937;color:#e6eef8;border:0;padding:.5rem .75rem;border-radius:8px;cursor:pointer}
    button:active{transform:translateY(1px)}
    .meta{color:#9fb0c9;font-size:.85rem}
  </style>
</head>
<body>
  <header>
    <h1>Podgląd pliku <code>licenses.txt</code></h1>
  </header>
  <main>
    <section class="card">
      <div class="toolbar">
        <button id="refreshBtn">Odśwież</button>
        <div class="meta">Ostatnia aktualizacja: <span id="ts">—</span></div>
      </div>
      <pre id="content">Ładowanie…</pre>
    </section>
  </main>

  <script>
    const URL = new URL('./licenses.txt', location.href).href; // plik w tym samym katalogu
    const contentEl = document.getElementById('content');
    const tsEl = document.getElementById('ts');
    const btn = document.getElementById('refreshBtn');

    let lastText = null;

    async function fetchAndUpdate() {
      try {
        const res = await fetch(URL, {cache: 'no-store'}); // wymusza pobranie najnowszej wersji
        if (!res.ok) throw new Error(res.status + ' ' + res.statusText);
        const txt = await res.text();
        if (txt !== lastText) {
          // pokaż dokładnie to, co jest w pliku
          contentEl.textContent = txt;
          lastText = txt;
        }
        tsEl.textContent = (new Date()).toLocaleString();
      } catch (e) {
        contentEl.textContent = 'Błąd podczas pobierania pliku: ' + e.message;
        tsEl.textContent = '—';
      }
    }

    // ręczne odświeżanie
    btn.addEventListener('click', () => {
      fetchAndUpdate();
    });

    // polling — co 5 sekund
    fetchAndUpdate();
    const interval = setInterval(fetchAndUpdate, 5000);

    // oszczędzaj: gdy karta niewidoczna, wydłuż interwał
    document.addEventListener('visibilitychange', () => {
      if (document.hidden) {
        clearInterval(window._licenseInterval);
        window._licenseInterval = setInterval(fetchAndUpdate, 30000);
      } else {
        clearInterval(window._licenseInterval);
        window._licenseInterval = setInterval(fetchAndUpdate, 5000);
        fetchAndUpdate();
      }
    });

    // store interval reference
    window._licenseInterval = setInterval(fetchAndUpdate, 5000);
  </script>
</body>
</html>
